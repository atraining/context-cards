!function(t,e,n){var i={url:t.location.href,owner_id:"6463634279",cs_uuid:"f60f5173-03b8-4490-8486-be8df4e22c02",channel_id:"e8a9949b-9116-447e-877a-17e4e7371f93",url_clean:"http://news.nationalgeographic.com/2016/04/160419-andromeda-galaxy-fermi-bubbles-space-science/",device_type:"desktop",traffic_source:"",whitelisted:"False",uuid_c_key:"__nfmp",message_rate:"5000",event_track_url:"//e.ndg.io",disallowed_lr:["9135924715"]};function o(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]}function r(t,e){try{var n,i=0,o=t.length;if(void 0===o||"function"==typeof t){for(n in t)if(!1===e.call(t[n],n,t[n]))break}else for(;i<o&&!1!==e.call(t[i],i,t[i++]););}catch(t){}return t}var s=function(t,e,n,i){n.addEventListener?n.addEventListener(t,function(t){e&&o(t,{data:e,element:n}),i(t)},!1):n.attachEvent&&n.attachEvent("on"+t,function(t){e&&o(t,{data:e,element:n}),i(t)})};function a(){var t="body",n="scrollHeight",i="offsetHeight",o="clientHeight",r="documentElement",s="getElementsByTagName",a=e[s]("html")[0],c=e[s]("body")[0],l=a.style.height,u=c.style.height;a.style.height="auto",c.style.height="auto";var d=Math.max(e[t][n]||0,e[r][n]||0,e[t][i]||0,e[r][i]||0,e[t][o]||0,e[r][o]||0);return a.style.height=l,c.style.height=u,d}function c(){return Math.max(e.documentElement.clientHeight,t.innerHeight||0)}var l=function(){this.dct=[]};l.prototype.put=function(t,e){return this.dct.push({key:t,value:e}),this},l.prototype.get=function(t){var e="";return r(this.dct,function(n,i){i.key==t&&(e=i.value)}),e},l.prototype.remove=function(t){return r(this.dct,function(e,n){n.key==t&&this.dct.splice(e,1)}),this},l.prototype.clear=function(){this.dct=[]},l.prototype.size=function(){return this.dct.length},l.prototype.query=function(){for(var t=[],e=0;e<this.dct.length;e++){var n=this.dct[e];t.push(encodeURIComponent(n.key)+"="+encodeURIComponent(n.value))}return t.join("&")},l.prototype.send=function(t,e){var n=new Image(1,1);if(n.src=t+"?"+this.query(),"function"==typeof e)if(n.complete)e();else{var i=!1;n.addEventListener("load",function(){1!=i&&e(),i=!0}),setTimeout(function(){1!=i&&(e(),i=!0)},4e3)}};var u=function(){this.dct={},this.k=new Array};u.prototype.put=function(t,e){return this.dct[t]=e,-1==this.k.indexOf(t)&&this.k.push(t),this},u.prototype.get=function(t){return this.dct[t]},u.prototype.remove=function(t){var e=this.k.indexOf(t);return-1!=e&&(this.k.splice(e,1),delete this.dct[t]),this},u.prototype.clear=function(){this.dct={},this.k=new Array},u.prototype.size=function(){return this.k.length},u.prototype.query=function(){var t=[];for(var e in this.dct)this.dct.hasOwnProperty(e)&&t.push(encodeURIComponent(e)+"="+encodeURIComponent(this.dct[e]));return t.join("&")},u.prototype.send=function(t,n,i){var o=e.createElement("script");o.src=t+"?"+this.query(),o.onload=function(){"function"==typeof n&&n(),void 0!==i&&o.parentNode.removeChild(o)},e.getElementsByTagName("head")[0].appendChild(o)};var d=function(){this.timer=0,this.iInstance=void 0,this.start(),this.is_paused=!1};d.prototype.start=function(){if(this.is_paused=!1,void 0===this.iInstance){var e=this;this.iInstance=t.setInterval(function(){e.timer+=1},1e3)}},d.prototype.stop=function(){void 0!==this.iInstance&&(this.is_paused=!0,clearInterval(this.iInstance),this.iInstance=void 0)},d.prototype.reset=function(){this.timer=0},d.prototype.get=function(){return this.timer},d.prototype.paused=function(){return this.is_paused};var f,h={rimg:function(){return{trigger:function(t){var e=new l;e.put("rand",(new Date).getTime()),r(t,function(t,n){e.put(t,n)}),e.put("url",i.url_clean),e.put("device_type",i.device_type),e.put("traffic_source",i.traffic_source),e.put("whitelisted",i.whitelisted),e.put("_fp",i.cs_uuid),e.put("channel",i.channel_id),e.send("//fallsm.ndg.io/collect/px.gif",void 0)}}}},_=new function(){var t=this;this.event=new function(){return{scroll:function(e){"undefined"!=typeof ndg_tracker_info&&1==ndg_tracker_info.fb_integration&&t.network.facebook.scroll_50(e)},timespent:function(e){"undefined"!=typeof ndg_tracker_info&&1==ndg_tracker_info.fb_integration&&t.network.facebook.attention_6(e)}}},this.network=new function(){this.attention_fired=!1,this.scroll_fired=!1;var t=this;return{facebook:{scroll_50:function(e){e+c()/2>a()/2&&!1===t.scroll_fired&&(t.scroll_fired=!0,"function"==typeof fbq&&fbq("trackCustom","scrollPercent",{scrollPercent:"50"}))},attention_6:function(e){e>=36&&!1===t.attention_fired&&(t.attention_fired=!0,"function"==typeof fbq&&fbq("trackCustom","Attention",{Attention:"0.6"}))}}}}},p=new function(){this.Utils={Tld:function(){var t=location.host,e=t.split(".");return e.length,"www"!=e[0]?t:e.slice(1).join(".")},getDate:function(t){var e=new Date;return e.setMinutes(e.getMinutes()+t),e},repeat:function(t,e){for(var n="",i=0;i<e;i++)n+=t;return n}};var n=this;this.gfaParam=function(e){var n,i=t.FallsmGlobalObj,o="";return i&&"function"==typeof t[i]&&(n=t[i].q)&&r(n,function(t,n){if(n[0]&&"string"==typeof n[0]&&n[0]==e)return o=n[1],!1}),o},this.loaded=function(t){if(void 0===this.readylist&&(this.readylist=[]),void 0!==t)"complete"==e.readyState?t():this.readylist.push(t);else for(var i=0;i<n.readylist.length;i++)n.readylist[i]()},n.loadinterval=t.setInterval(function(){"complete"==e.readyState&&(clearTimeout(n.loadinterval),n.loaded())},100)},g={startSession:function(t){o(this.globals,t),this.start=new Date},get_scroll_height_adjuster:function(e){if(void 0!==t.ndg_tracker_info){var n=t.ndg_tracker_info.doc_heights;for(var i in n)if(e>=n[i][0]&&e<=n[i][1])return n[i][0]-1}return 0},scroll:function(t){var e=this.get_scroll_height_adjuster(t);if(t-=e,_.event.scroll(t),this.globals.last_scroll_pos=t,t=(t+c())/(a()-e),this.data.max_scroll<t){var n=this.data.max_scroll;this.data.max_scroll=t,this.data.esf=t-n}},share:function(t){var e=new Date-this.start;-1===this.globals.share_types.indexOf(t)&&(this.data.tus+=1,this.globals.share_types.push(t)),this.data.share.push({network:t,time_offset:e})},timespent:{check_unfilled:function(){var t=o({},g.data.time_taken),e=0,n=0;!function(t,e){var n=[];for(var i in t)n.push(i);for(var o=n.length-1;o>=0;o--)e.call(t,n[o])}(t,function(t){parseInt(t)<parseInt(e)&&0==g.data.time_taken[t]&&(g.data.time_taken[t]=n,g.globals.timespent_changed=!0),0!=g.data.time_taken[t]&&(e=t,n=g.data.time_taken[t])})},check:function(){_.event.timespent(g.data.heartbeat);var t=g.globals.last_scroll_pos,e=g.globals.doc_height/20,n=t+g.globals.viewport_height;r(g.data.time_taken,function(i,o){(i/5-1)*e>t-e/1.5&&i/5*e<n+e/1.5&&0==g.data.time_taken[i]&&(g.data.time_taken[i]=g.data.heartbeat,g.globals.timespent_changed=!0)}),this.check_unfilled()}},collectStatic:function(){return{hbv:i.message_rate/1e3}},globals:{last_scroll_pos:0,timespent_changed:!1,adblock_send:!1,share_types:[]},data:{heartbeat:0,share:[],max_scroll:0,tus:0,esf:0,time_taken:{5:0,10:0,15:0,20:0,25:0,30:0,35:0,40:0,45:0,50:0,55:0,60:0,65:0,70:0,75:0,80:0,85:0,90:0,95:0,100:0}},clean:function(){this.data.share=[],this.data.esf=0,this.data.tus=0,this.globals.share_types=[],this.globals.timespent_changed=!1}},v={notification_imgs:function(){var t;(t=new l).put("partner_uid","f60f5173-03b8-4490-8486-be8df4e22c02"),t.send("//idsync.rlcdn.com/462326.gif",void 0)}},m=(f=new function(){return{old_target:void 0,scroll_pos:-1,timer:void 0,idleTimer:void 0,blurred:!1,registerMouseMove:function(t){this.notifyActive()},registerClick:function(t){this.notifyActive()},registerBlur:function(){this.blurred=!0,this.notifyInactive()},registerFocus:function(){this.blurred=!1,this.notifyActive()},videoPlaying:function(){this.blurred||this.notifyActive()},notifyActive:function(){this.timer.start(),this.idleTimer.reset()},notifyInactive:function(){this.timer.stop()},getScrollPosition:function(){var n=e.body.scrollTop;0==n&&(n=t.pageYOffset?t.pageYOffset:e.body.parentElement?e.body.parentElement.scrollTop:0),this.scroll_pos!=n&&(this.scroll_pos=n,g.scroll(this.scroll_pos),this.notifyActive())}}},{tracked_url:i.url_clean,transport:{notifyShare:function(t){g.share(t)}},getCollectData:function(){var e={};void 0!==t.FaAdblock&&0==g.globals.adblock_send&&(e={adblock:FaAdblock.checkAdBlocked()},g.globals.adblock_send=!0);var n=o({},e,g.data);return 0==g.globals.timespent_changed&&delete n.time_taken,n},init_session_timer:function(){g.startSession({doc_height:a(),viewport_height:c()}),s("blur",{},t,function(t){f.registerBlur(t)}),s("focus",{},t,function(t){f.registerFocus(t)}),s("ndg_video_playing",{},e,function(t){f.videoPlaying(t)}),f.timer=new d,f.idleTimer=new d;var n=this;this.Intvl_heartbeat=setInterval(function(){if(f.timer.paused()||(g.data.heartbeat=f.timer.get(),g.timespent.check()),window.ndg_t=f.timer.get(),f.idleTimer.get()>=20&&f.notifyInactive(),!f.timer.paused()){var t=n.getCollectData();o(t,g.collectStatic()),n.engine.trigger({data:JSON.stringify(t)}),g.clean()}},i.message_rate)},init_mouse_events:function(){s("mousemove",{},t,function(t){f.registerMouseMove(t)}),s("mouseup",{},t,function(t){f.registerClick(t)}),setInterval(function(){f.getScrollPosition()},300)},fix_inifinity_scroll_heights:function(){void 0===t.ndg_tracker_info&&(t.ndg_tracker_info={});var e=function(e,n){0==e?(t.ndg_tracker_info.doc_heights=[],t.ndg_tracker_info.doc_heights.push([0,n]),t.ndg_tracker_info.old_doc_height=n):e<n&&(t.ndg_tracker_info.doc_heights.push([e+1,n]),t.ndg_tracker_info.old_doc_height=n)},n=a(),i=t.ndg_tracker_info.old_doc_height?t.ndg_tracker_info.old_doc_height:0;Math.abs(n-i)<1e3?window.setTimeout(function(){n=a(),Math.abs(n-i)>=1e3&&e(i,n)},1e3):e(i,n)},init:function(){var t,n,o,r,s,a;this.engine=h.rimg(),t=i.uuid_c_key,n=i.cs_uuid,o=p.Utils.getDate(1051200).toGMTString(),r="/",s=p.Utils.Tld(),e.cookie=t+"="+escape(n)+(o?";expires="+o:"")+(r?";path="+r:"")+(s?";domain="+s:"")+(a&&1==a?"; secure":""),this.fix_inifinity_scroll_heights(),this.init_session_timer(),this.init_mouse_events(),(new u).send("//cdn.ndg.io/shared/extra.min.js"),i.disallowed_lr.includes(i.owner_id)||v.notification_imgs()}});!function(){if("undefined"==typeof ndg)return!1;var t=function(){r(ndg.q,function(t,e){var n,o,s,a,c,u,d="",f="",h="",_=[];if("object"==typeof e[0]?(d=e[0].name||"",f=e[0].content_id||"","string"==typeof e[1]&&_.push(e[1])):"string"==typeof e[0]&&(d=e[0]||"",f=e[1]||""),"function"==typeof e[1]?h=e[1]:"function"==typeof e[2]&&(h=e[2]),e.length>2)for(var p=2;p<e.length;p++)"string"==typeof e[p]&&_.push(e[p]);n=d,o=f,s=_,a=h,(c=new l).put("owner_id",i.owner_id),c.put("name",n),c.put("content_id",o),c.put("url",i.url_clean),r(s,function(t,e){c.put("metadata",e)}),c.send(i.event_track_url+"/v1/v.gif",function(){"function"==typeof a&&a()}),u=t,ndg.q.splice(u,1)})};window.setInterval(function(){try{t()}catch(t){}},1e3)}(),t.fm_channel=m,m.init()}(window,document);